<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time Punch</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,system-ui,"Segoe UI",sans-serif;background:#f5f5f5;margin:0;padding:16px}
    .card{max-width:720px;margin:0 auto;background:#fff;border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.08);padding:16px}
    h1{text-align:center;font-size:20px;margin:0 0 10px}
    .field{margin-bottom:10px}
    label{font-size:12px;color:#555}
    input{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:12px;font-size:14px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;font-size:13px}
    .ok{background:#e8f5e9}
    .bad{background:#ffebee}
    .mid{background:#e3f2fd}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center;margin:10px 0}
    button{flex:1;min-width:140px;padding:14px;border:0;border-radius:999px;font-size:16px}
    button:disabled{opacity:.5}
    .in{background:#2e7d32;color:#fff}
    .out{background:#c62828;color:#fff}
    .break{background:#1565c0;color:#fff}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .smallbtn{padding:10px 12px;font-size:13px;background:#1976d2;color:#fff;border-radius:999px;border:0}
  </style>
</head>
<body>
  <div class="card">
    <h1>Time Punch</h1>

    <div class="field">
      <label>Worker Name</label>
      <input id="worker" placeholder="Enter worker name" />
    </div>

    <div class="row" style="justify-content:space-between">
      <div>Status: <span id="status" class="pill bad">Off the clock</span></div>
      <div id="today"></div>
    </div>

    <div class="row">
      <button id="inBtn" class="in">Punch In</button>
      <button id="outBtn" class="out" disabled>Punch Out</button>
    </div>

    <div class="row">
      <button id="breakIn" class="break" disabled>Start Meal Break</button>
      <button id="breakOut" class="break" disabled>End Meal Break</button>
    </div>

    <table>
      <thead>
        <tr><th>In</th><th>Break</th><th>Out</th><th>Net Hours</th></tr>
      </thead>
      <tbody id="log"></tbody>
    </table>

    <div class="row">
      <button id="export" class="smallbtn">Export CSV</button>
    </div>
  </div>

<script>
const KEY="tp_worker_simple";
const META="tp_worker_name";
const $=id=>document.getElementById(id);

function load(){return JSON.parse(localStorage.getItem(KEY)||"[]")}
function save(d){localStorage.setItem(KEY,JSON.stringify(d))}

function today(){return new Date().toLocaleDateString()}
$("today").textContent=today();

$("worker").value=localStorage.getItem(META)||"";
$("worker").oninput=e=>localStorage.setItem(META,e.target.value);

function render(){
 const d=load(), open=d.find(x=>!x.out);
 $("status").textContent=open?"On the clock":"Off the clock";
 $("status").className="pill "+(open?"ok":"bad");
 $("inBtn").disabled=!!open;
 $("outBtn").disabled=!open || (open&&open.bs&&!open.be);
 $("breakIn").disabled=!open || open.bs;
 $("breakOut").disabled=!(open&&open.bs&&!open.be);
 const tb=$("log"); tb.innerHTML="";
 d.forEach(e=>{
  const tr=document.createElement("tr");
  const hrs=e.out?(((new Date(e.out)-new Date(e.in))-(e.bs&&e.be?(new Date(e.be)-new Date(e.bs)):0))/36e5).toFixed(2):"";
  tr.innerHTML=`<td>${new Date(e.in).toLocaleTimeString()}</td>
                <td>${e.bs?new Date(e.bs).toLocaleTimeString():""}${e.be?"-"+new Date(e.be).toLocaleTimeString():""}</td>
                <td>${e.out?new Date(e.out).toLocaleTimeString():""}</td>
                <td>${hrs}</td>`;
  tb.appendChild(tr);
 });
}

$("inBtn").onclick=()=>{const d=load();d.push({in:new Date(),out:null,bs:null,be:null});save(d);render();}
$("outBtn").onclick=()=>{const d=load();d.find(x=>!x.out).out=new Date();save(d);render();}
$("breakIn").onclick=()=>{const d=load();d.find(x=>!x.out).bs=new Date();save(d);render();}
$("breakOut").onclick=()=>{const d=load();d.find(x=>!x.out).be=new Date();save(d);render();}

$("export").onclick=()=>{
 const name=localStorage.getItem(META)||"";
 let csv="Worker,In,Break Start,Break End,Out,Net Hours\n";
 load().forEach(e=>{
  const hrs=e.out?(((new Date(e.out)-new Date(e.in))-(e.bs&&e.be?(new Date(e.be)-new Date(e.bs)):0))/36e5).toFixed(2):"";
  csv+=`"${name}",${new Date(e.in).toISOString()},${e.bs?new Date(e.bs).toISOString():""},${e.be?new Date(e.be).toISOString():""},${e.out?new Date(e.out).toISOString():""},${hrs}\n`;
 });
 const b=new Blob([csv]); const a=document.createElement("a");
 a.href=URL.createObjectURL(b); a.download="time_log.csv"; a.click();
}

render();
</script>
</body>
</html>
